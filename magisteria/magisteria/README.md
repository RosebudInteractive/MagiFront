# MagisteriaTwo

В проекте собран весь фронтэнд Магистерии
* **frontend** - публичный сайт `localhost:4000`
* **src** - старая админка `localhost:4000/adm/`
* **team-task** - бэкофис (процесс менеджер) `localhost:4000/pm/`
* **test-app** - приложение, которое используется в нативном приложении Magisteria для доступа к тестам `localhost:4000/test-app/`
* **mailing** - генерация писем для рассылки `localhost:4000/mailing/`

Для работы с проектом необходимо использовать пакетный менеджер `npm`, работа с `yarn` не проверена.
Проверенные версии `node`: 12, 14.

###Скрипты запуска:
* `npm install` - установка всех зависимостей,
* `npm run start` - запуск webpack dev server(по умолчанию запускается на 3000 порту),
* `npm run build` - создает рабочую минифицированную сборку в папке build
* `npm run ts` - запуск ts компилятора в режиме watch

Для проекта необходимо наличие директории `timeline-lib` с файлом index.js, который собирается в проетке **Timeline**

Для того чтобы изменить порт dev server, необходимо установить переменную окружения 

`SET PORT=4000`

По умолчанию dev server запускается в режиме proxy на `localhost:3000`, там должен быть запущен сервер Магистерии.
Туда перенаправляются запросы `api`, `data`, `doc`. Чтобы изменить proxy, необходимо установить переменную окружения

`SET PROXY_URL=https://dev.magisteria.ru`

###Mailing
Подпроект `mailing` имеет список готовых шаблонов писем
* `mailing/registration` - письмо об успешной регистрации пользователя
* `mailing/new-course/:courseId` - письмо о новом курсе, где: 

    `courseId` - идентификатор нового курса. Данные о курсе берутся из базы Магистерии

* `mailing/purchase-promo/:courseId?username=User&promo=PROMO` - письмо на покупку подарочного промокода, где:
    
    `username` - имя пользователя, параметр необязательный,
    
    `promo` - промокод
    
* `mailing/purchase-course/:courseId?username=User&promo=PROMO&lvl=1` - письмо на покупку курса с промокодом на покупку следующего, где:
    
    `username` - имя пользователя, параметр необязательный,
    
    `promo` - промокод,
    
    `lvl` - уровень накопленной скидки. Значения скидки хранятся в БД и доступны по `/api/courses/discounts`

* `mailing/our-birthday5?username=User&promo=PROMO&giftType=1` - письмо на 5-летие Магистерии, где:
    
    `username` - имя пользователя, параметр необязательный,
    
    `promo` - промокод,
    
    `giftType` - тип подарка
    * 1 - Промокод на скидку 50% (2 курса)
    * 2 - Промокод на 1 курс
    * 3 - Промокод  на 2 курса
    
* `mailing/ny22-promo?username=User&promo=PROMO&giftType=1` - письмо на 5-летие Магистерии, где:
    
    `username` - имя пользователя, параметр необязательный,
    
    `promo` - промокод,
    
    `giftType` - тип подарка
    * 1 - Промокод на 25 курсов
    * 2 - Промокод на 5 курсов
